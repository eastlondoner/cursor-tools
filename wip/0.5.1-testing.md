# cursor-tools v0.5.1 Test Plan

This test plan covers all changes since v0.5.0. The tests should be performed manually using `pnpm dev` for commands and `pnpm serve-test` for browser-related tests.

## Test Environment Setup

Before running tests:

1. Start the test server for browser tests in a separate terminal:
   ```bash
   pnpm serve-test
   ```

2. For browser connection tests, use headless mode wherever possible unless testing --connect-to.

## I. New Cursor IDE Project Rules Structure

These tests should be performed in a test directory outside of the cursor-tools repository to simulate a user project.

### 1. Fresh Installation (New Structure)

**Commands:**
```bash
mkdir test-project
cd test-project
pnpm init -y
pnpm add -D ../  # Install cursor-tools from the local directory
pnpm exec cursor-tools install .
```

**Expected Outcomes:**
- `.cursor/rules/cursor-tools.mdc` file should be created
- File should contain correct template content with matching version number
- No `.cursorrules` file should be created
- Success message should be displayed
- Cursor agent should recognize available cursor-tools commands

### 2. Installation with Legacy `.cursorrules` File

**Setup:**
1. In test-project directory, manually create `.cursorrules` with arbitrary content
2. Run installation

**Command:**
```bash
pnpm exec cursor-tools install .
```

**Expected Outcomes:**
- `.cursor/rules/cursor-tools.mdc` should be created/updated
- `.cursorrules` should remain unchanged
- Warning message about legacy file should be displayed
- Cursor agent should still work correctly

### 3. Installation with Both Files

**Setup:**
Ensure both `.cursor/rules/cursor-tools.mdc` and `.cursorrules` exist

**Command:**
```bash
pnpm exec cursor-tools install .
```

**Expected Outcomes:**
- `.cursor/rules/cursor-tools.mdc` should be updated if needed
- `.cursorrules` should remain unchanged
- Warning about legacy file should be displayed
- Cursor agent should use .mdc file

### 4. Installation with Corrupted/Invalid New Rules File

**Setup:**
Manually corrupt `.cursor/rules/cursor-tools.mdc` by removing key sections

**Command:**
```bash
pnpm exec cursor-tools install .
```

**Expected Outcomes:**
- Install should complete successfully
- File should be overwritten with correct template
- Terminal should indicate rules were updated

### 5. Missing API Keys During Install

**Setup:**
Remove any existing API key files/environment variables

**Command:**
```bash
pnpm exec cursor-tools install .
```

**Expected Outcomes:**
- Should prompt for all API keys
- Empty responses should be allowed
- `SKIP_STAGEHAND=true` if Stagehand setup skipped
- Warning if no Stagehand keys provided
- Only provided keys should be in env file
- Installation should complete without errors

### 6. Existing API Keys During Install

**Setup:**
Create `.cursor-tools.env` with all required API keys

**Command:**
```bash
pnpm exec cursor-tools install .
```

**Expected Outcomes:**
- Should complete without prompting for keys

## II. Browser Command Improvements

### 1. Console and Network Logging (Default On)

**Command:**
```bash
pnpm dev browser open http://localhost:3000/console-network-test.html
```

**Expected Outcomes:**
- Terminal should show console messages:
  - "Test log message"
  - "Test warning message"
  - "Test error message"
  - "Network response:..."
  - "Network error:..."
- Should show network request/response info

### 2. Console and Network Logging (Disable)

**Command:**
```bash
pnpm dev browser open http://localhost:3000/console-network-test.html --no-console --no-network
```

**Expected Outcomes:**
- No console messages should appear
- No network info should appear

### 3. Page Reuse (--connect-to)

**Setup:**
1. Start Chrome with remote debugging (port 9222)
2. Open tabs with:
   - http://localhost:3000/test.html
   - http://localhost:3000/console-log.html

**Test Sequence:**

a) New Page:
```bash
pnpm dev browser open http://localhost:3000/interactive-test.html --connect-to=9222
```
- Should reuse last tab (console-log.html)

b) Current Page:
```bash
pnpm dev browser open current --connect-to=9222
```
- Active tab should remain unchanged

c) Reload Current:
```bash
pnpm dev browser open reload-current --connect-to=9222
```
- Active tab should reload

### 4. Viewport Handling (--connect-to)

**Test Sequence:**

a) Without Viewport:
```bash
pnpm dev browser open http://localhost:3000/test.html --connect-to=9222
```
- Viewport should not change

b) With Viewport:
```bash
pnpm dev browser open http://localhost:3000/test.html --connect-to=9222 --viewport=800x600
```
- Viewport should change to 800x600

### 5. Video Recording (--connect-to Conflict)

**Command:**
```bash
pnpm dev browser open http://localhost:3000/test.html --connect-to=9222 --video=test-videos
```

**Expected Outcome:**
- Should error about video/connect-to conflict

### 6. Basic Browser Commands

**Commands and Expected Outcomes:**

a) Act:
```bash
pnpm dev browser act "click btn1" --url=http://localhost:3000/test.html
```
- Should indicate success

b) Observe:
```bash
pnpm dev browser observe "Find the buttons" --url=http://localhost:3000/test.html
```
- Should list interactive buttons

c) Extract:
```bash
pnpm dev browser extract "Find the buttons" --url=http://localhost:3000/test.html
```
- Should list buttons

## III. gpt-4o Model Support

### 1. gpt-4o with browser act

**Setup:**
Ensure OpenAI API key is available

**Command:**
```bash
pnpm dev browser act "Click Button 1" --url=http://localhost:3000/test.html --model=gpt-4o
```

**Expected Outcomes:**
- Should execute successfully
- Should use gpt-4o model
- Action should be performed correctly

### 2. gpt-4o with browser extract

**Command:**
```bash
pnpm dev browser extract "Get the button text" --url=http://localhost:3000/test.html --model=gpt-4o
```

**Expected Outcomes:**
- Should execute successfully
- Should extract correct text

### 3. gpt-4o with browser observe

**Command:**
```bash
pnpm dev browser observe "Find interactive elements" --url=http://localhost:3000/test.html --model=gpt-4o
```

**Expected Outcomes:**
- Should execute successfully
- Should list correct elements

### 4. Invalid Model Test

**Command:**
```bash
pnpm dev browser act "Click Button 1" --url=http://localhost:3000/test.html --model=invalid-model
```

**Expected Outcomes:**
- Should show warning about unknown model
- Should still attempt to execute

### 5. Default Model (OpenAI)

**Setup:**
- Remove/rename .cursor-tools.env
- Set only OPENAI_API_KEY

**Command:**
```bash
pnpm dev browser act "Click Button 1" --url=http://localhost:3000/test.html
```

**Expected Outcome:**
- Should use o3-mini model by default

### 6. Default Model (Anthropic)

**Setup:**
- Remove/rename .cursor-tools.env
- Set only ANTHROPIC_API_KEY

**Command:**
```bash
pnpm dev browser act "Click Button 1" --url=http://localhost:3000/test.html
```

**Expected Outcome:**
- Should use claude-3-5-sonnet-latest by default

## IV. Stagehand Script Bundling

### 1. Build Verification

**Command:**
```bash
pnpm build
```

**Expected Outcomes:**
- Build should complete successfully
- dist/index.mjs should be created
- STAGEHAND_SCRIPT constant should exist in output
- No require('@browserbasehq/stagehand') should be present

### 2. Release Script Verification

**Command:**
```bash
pnpm run verify-stagehand
```

**Expected Outcomes:**
- Should complete successfully
- Should show "âœ“ Stagehand script verification passed"

### 3. Linting with Stagehand File

**Command:**
```bash
pnpm run lint
```

**Expected Outcome:**
- No Stagehand-related linting errors 